# ĞÑ‚Ñ‡ĞµÑ‚ Ğ¾ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğ¸ Ğ»Ğ°Ğ±Ğ¾Ñ€Ğ°Ñ‚Ğ¾Ñ€Ğ½Ğ¾Ğ¹ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ â„–4
## ĞŸÑ€ĞµĞ¾Ğ±Ñ€Ğ°Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Oscar Service Ğ² SOAP Ğ¸ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ‡ĞµÑ€ĞµĞ· Mule ESB

---

## ğŸ¯ Ğ¦ĞµĞ»ÑŒ Ğ»Ğ°Ğ±Ğ¾Ñ€Ğ°Ñ‚Ğ¾Ñ€Ğ½Ğ¾Ğ¹ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹

1. **ĞŸÑ€ĞµĞ¾Ğ±Ñ€Ğ°Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Oscar Service Ğ² SOAP Ğ¿Ñ€Ğ¾Ñ‚Ğ¾ĞºĞ¾Ğ»** - Ğ¿ĞµÑ€ĞµĞ¿Ğ¸ÑĞ°Ñ‚ÑŒ REST API Ğ½Ğ° SOAP (JAX-WS)
2. **Ğ Ğ°Ğ·Ğ²ĞµÑ€Ğ½ÑƒÑ‚ÑŒ SOAP ÑĞµÑ€Ğ²Ğ¸Ñ Ğ½Ğ° Payara** - Ğ±ĞµĞ· Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ movie-service
3. **Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ¸ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ Mule ESB** - Ğ´Ğ»Ñ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ²
4. **Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ REST-Ğ¿Ñ€Ğ¾ĞºÑĞ¸ ÑĞ»Ğ¾Ğ¹ Ñ‡ĞµÑ€ĞµĞ· Mule ESB** - Ğ¿Ñ€ĞµĞ´Ğ¾ÑÑ‚Ğ°Ğ²Ğ¸Ñ‚ÑŒ REST API Ğ´Ğ»Ñ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ¾Ğ², ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğ¹ Ğ¿Ñ€Ğ¾ĞºÑĞ¸Ñ€ÑƒĞµÑ‚ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹ Ğº SOAP ÑĞµÑ€Ğ²Ğ¸ÑÑƒ
5. **ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ HAProxy Ğ¸ Nginx** - Ğ´Ğ»Ñ Ğ±Ğ°Ğ»Ğ°Ğ½ÑĞ¸Ñ€Ğ¾Ğ²ĞºĞ¸ Ğ½Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ğ¸ Ğ¿Ñ€Ğ¾ĞºÑĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²

---

## ğŸ—ï¸ ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ

### Ğ”Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ° Ğ´ĞµĞ¿Ğ»Ğ¾Ñ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ğŸŒ Frontend (Flutter Web)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚ HTTPS:8443
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ğŸ”’ NGINX (Port 8443)                         â”‚
â”‚  â€¢ SSL Termination                                             â”‚
â”‚  â€¢ CORS Headers                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Routes:                                                       â”‚
â”‚  / â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> Flutter Web App (static files)            â”‚
â”‚  /movies/* â”€â”€â”€â”€â”€â”€â”€â”€> proxy_pass http://127.0.0.1:8080/...     â”‚
â”‚  /oscar/* â”€â”€â”€â”€â”€â”€â”€â”€â”€> proxy_pass http://127.0.0.1:8081/...    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚ HTTP
                             â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                         â”‚
        â–¼                                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âš–ï¸  HAProxy (8080)  â”‚            â”‚  ğŸ”„ Mule ESB (8081)  â”‚
â”‚  Load Balancer       â”‚            â”‚  REST Proxy Layer    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Frontend: fe_movie   â”‚            â”‚ â€¢ REST â†’ SOAP        â”‚
â”‚ â€¢ /service2 â†’ oscar  â”‚            â”‚ â€¢ SOAP â†’ REST        â”‚
â”‚ â€¢ default â†’ movie    â”‚            â”‚ â€¢ DataWeave          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ Backends:            â”‚                       â”‚ HTTP:8080
â”‚ â€¢ movie-service      â”‚                       â”‚ (via HAProxy)
â”‚   (Consul DNS)       â”‚                       â”‚
â”‚   - 9003, 9004       â”‚                       â–¼
â”‚ â€¢ oscar-service      â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   (Static)           â”‚            â”‚  âš–ï¸  HAProxy (8080)    â”‚
â”‚   - 9001, 9002       â”‚            â”‚  Load Balancer        â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚  Round-robin         â”‚
       â”‚                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
       â”‚               â”‚               â”‚       â”‚
       â–¼               â–¼               â–¼       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MOVIE-1     â”‚ â”‚ MOVIE-2     â”‚ â”‚ OSCAR-1     â”‚ â”‚ OSCAR-2     â”‚
â”‚ Port: 9003  â”‚ â”‚ Port: 9004  â”‚ â”‚ Port: 9001  â”‚ â”‚ Port: 9002  â”‚
â”‚             â”‚ â”‚             â”‚ â”‚             â”‚ â”‚             â”‚
â”‚ Spring Boot â”‚ â”‚ Spring Boot â”‚ â”‚ Payara      â”‚ â”‚ Payara      â”‚
â”‚ + Consul    â”‚ â”‚ + Consul    â”‚ â”‚ instance1   â”‚ â”‚ instance2   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚               â”‚               â”‚               â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
                   â”‚                                   â”‚
                   â”‚ Register to Consul               â”‚ Call via JNDI
                   â”‚                                   â”‚
                   â–¼                                   â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ ğŸ“¡ CONSUL           â”‚            â”‚ ğŸ”§ EJB POOL         â”‚
         â”‚ Port: 8500 (HTTP)   â”‚            â”‚ (Stateless)         â”‚
         â”‚ Port: 8600 (DNS)    â”‚            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚ OscarServiceBean    â”‚
         â”‚ Service Discovery   â”‚            â”‚ @Remote interface   â”‚
         â”‚ â€¢ movie-service     â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚   - instance 9003   â”‚
         â”‚   - instance 9004   â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ‡Ğ°Ğ½Ğ¸Ğµ:** Payara DAS Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ Ğ½Ğ° Ğ¿Ğ¾Ñ€Ñ‚Ñƒ 8180 (Ğ½Ğµ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ğ½ Ğ½Ğ° Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğµ, Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ»Ñ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ).

### ĞŸĞ¾Ñ‚Ğ¾Ğº Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²

#### 1. Ğ—Ğ°Ğ¿Ñ€Ğ¾Ñ Ğº Movie Service
```
Browser â†’ Nginx (8443) â†’ HAProxy (8080) â†’ Movie Service (9003/9004)
```

#### 2. Ğ—Ğ°Ğ¿Ñ€Ğ¾Ñ Ğº Oscar Service
```
Browser â†’ Nginx (8443) â†’ Mule ESB (8081) â†’ HAProxy (8080) â†’ Oscar Service (9001/9002)
```

#### 3. Oscar Service Ğ²Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ Movie Service
```
Oscar Service â†’ HAProxy (8080) â†’ Movie Service (9003/9004)
```

---

## ğŸ“ ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ

### 1. Oscar Service - ĞŸÑ€ĞµĞ¾Ğ±Ñ€Ğ°Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ² SOAP

#### Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ñ‹ REST ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹:
- `OscarResource.java` - REST ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»Ğ»ĞµÑ€
- `OscarApplication.java` - JAX-RS Application
- `SwaggerUIResource.java` - Swagger UI
- `GenericExceptionMapper.java` - Exception mapper

#### Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½ SOAP endpoint:
**Ğ¤Ğ°Ğ¹Ğ»:** `oscar-service-web/src/main/java/ru/itmo/soa/oscar/web/soap/OscarSoapService.java`

- `@WebService` Ñ namespace `http://soa.itmo.ru/oscar`
- `@BindingType(SOAPBinding.SOAP12HTTP_BINDING)` - SOAP 1.2
- ĞœĞµÑ‚Ğ¾Ğ´Ñ‹: `getDirectorsWithoutOscars()`, `humiliateDirectorsByGenre(String genre)`
- Ğ›Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ JNDI lookup Ğ´Ğ»Ñ EJB: `java:global/oscar-service/.../OscarServiceBean!...`

#### Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ñ‹ JAXB Ğ°Ğ½Ğ½Ğ¾Ñ‚Ğ°Ñ†Ğ¸Ğ¸ Ğ² DTO:
- `DirectorInfo.java` - `@XmlRootElement`, `@XmlType`, `@XmlElement`
- `HumiliateResponse.java` - Ğ°Ğ½Ğ°Ğ»Ğ¾Ğ³Ğ¸Ñ‡Ğ½Ğ¾
- `MovieGenre.java` - enum Ñ JAXB

#### Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ğ² ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸:
- `application.properties`: `movie.service.base.url=http://localhost:8080/service1/api/v1` (Ñ‡ĞµÑ€ĞµĞ· HAProxy)
- `pom.xml`: ÑƒĞ´Ğ°Ğ»ĞµĞ½Ñ‹ JAX-RS Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸, Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ñ‹ JAXB
- `web.xml`: ÑƒĞ¿Ñ€Ğ¾Ñ‰ĞµĞ½ Ğ´Ğ»Ñ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ¹ Ğ¿ÑƒĞ±Ğ»Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸ JAX-WS

### 2. Mule ESB - REST Proxy Layer

#### ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ:
**Ğ¤Ğ°Ğ¹Ğ»:** `muleesb/lab4/src/main/mule/lab4.xml`

- HTTP Listener Ğ½Ğ° Ğ¿Ğ¾Ñ€Ñ‚Ñƒ 8081
- HTTP Request Ğº SOAP ÑĞµÑ€Ğ²Ğ¸ÑÑƒ Ñ‡ĞµÑ€ĞµĞ· HAProxy (Ğ¿Ğ¾Ñ€Ñ‚ 8080)
- HTTP Request Ğº Movie Service Ñ‡ĞµÑ€ĞµĞ· HAProxy (Ğ¿Ğ¾Ñ€Ñ‚ 8080)
- DataWeave Ğ¿Ñ€ĞµĞ¾Ğ±Ñ€Ğ°Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ:
  - REST JSON â†’ SOAP XML (Ğ´Ğ»Ñ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²)
  - SOAP XML â†’ REST JSON (Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¾Ğ²)

#### Flows:
1. `getDirectorsWithoutOscarsFlow` - POST `/service2/oscar/directors/get-loosers`
2. `humiliateDirectorsByGenreFlow` - POST `/service2/oscar/directors/humiliate-by-genre/{genre}`

#### Ğ¢ĞµÑ…Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ´ĞµÑ‚Ğ°Ğ»Ğ¸:
- Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½ Mule Community Edition 4.6.0
- DataWeave Ğ²Ñ‹Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ Ğ² `<set-payload>` (Ğ±ĞµĞ· `ee:transform`)
- ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° XML namespaces Ğ¸ Ğ¼Ğ°ÑÑĞ¸Ğ²Ğ¾Ğ² Ğ² SOAP Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ°Ñ…

### 3. HAProxy - Load Balancer

**ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ:** `/etc/haproxy/haproxy.cfg`

- Frontend Ğ½Ğ° Ğ¿Ğ¾Ñ€Ñ‚Ñƒ 8080
- Backend `movie-service`: Ğ±Ğ°Ğ»Ğ°Ğ½ÑĞ¸Ñ€Ğ¾Ğ²ĞºĞ° Ñ‡ĞµÑ€ĞµĞ· Consul DNS (Ğ¿Ğ¾Ñ€Ñ‚Ñ‹ 9003, 9004)
- Backend `oscar-service`: ÑÑ‚Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ (Ğ¿Ğ¾Ñ€Ñ‚Ñ‹ 9001, 9002)
- Health checks Ğ´Ğ»Ñ Ğ¾Ğ±Ğ¾Ğ¸Ñ… Ğ±ÑĞºĞµĞ½Ğ´Ğ¾Ğ²
- Round-robin Ğ±Ğ°Ğ»Ğ°Ğ½ÑĞ¸Ñ€Ğ¾Ğ²ĞºĞ°

**Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ğ² ĞºĞ¾Ğ´Ğµ:**
- `oscar-service`: Ğ¾Ğ±Ñ€Ğ°Ñ‰ĞµĞ½Ğ¸Ğµ Ğº `movie-service` Ñ‡ĞµÑ€ĞµĞ· `http://localhost:8080` (HAProxy)
- `muleesb`: Ğ¾Ğ±Ñ€Ğ°Ñ‰ĞµĞ½Ğ¸Ğµ Ğº SOAP ÑĞµÑ€Ğ²Ğ¸ÑÑƒ Ñ‡ĞµÑ€ĞµĞ· `http://localhost:8080` (HAProxy)
- `muleesb`: Ğ¾Ğ±Ñ€Ğ°Ñ‰ĞµĞ½Ğ¸Ğµ Ğº Movie Service Ñ‡ĞµÑ€ĞµĞ· `http://localhost:8080` (HAProxy)
- `nginx`: Ğ¿Ñ€Ğ¾ĞºÑĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ `/movies/*` Ğ½Ğ° `http://127.0.0.1:8080` (HAProxy)
- `start.sh`: Ğ·Ğ°Ğ¿ÑƒÑĞº HAProxy Ğ¿ĞµÑ€ĞµĞ´ Payara, Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ñ€Ñ‚Ğ° Payara DAS Ğ½Ğ° 8180

### 4. Nginx - Reverse Proxy

**ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ:** `/etc/nginx/sites-available/default`

- `/oscar/*` â†’ `http://127.0.0.1:8081/service2/oscar/` (Mule ESB)
- `/movies/*` â†’ `http://127.0.0.1:8080/service1/api/v1/movies` (HAProxy)
- CORS headers Ğ´Ğ»Ñ Ğ²ÑĞµÑ… Ğ¼Ğ°Ñ€ÑˆÑ€ÑƒÑ‚Ğ¾Ğ²

### 5. start.sh - ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ´ĞµĞ¿Ğ»Ğ¾Ñ

**Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ:**
- Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ° ÑĞ±Ğ¾Ñ€ĞºĞ° Mule ESB Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ
- Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½ Ğ·Ğ°Ğ¿ÑƒÑĞº Mule ESB (Ğ¿Ğ¾Ñ€Ñ‚ 8081)
- Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½ Ğ·Ğ°Ğ¿ÑƒÑĞº HAProxy
- ĞÑĞ²Ğ¾Ğ±Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ñ€Ñ‚Ğ° 8080 Ğ¿ĞµÑ€ĞµĞ´ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ¾Ğ¼ HAProxy
- ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½ summary Ñ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸ĞµĞ¹ Ğ¾ HAProxy

---

## ğŸ”§ Ğ¢ĞµÑ…Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ´ĞµÑ‚Ğ°Ğ»Ğ¸

### ĞŸĞ¾Ñ€Ñ‚Ñ‹ ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ²

| Ğ¡ĞµÑ€Ğ²Ğ¸Ñ | ĞŸĞ¾Ñ€Ñ‚ | ĞŸÑ€Ğ¾Ñ‚Ğ¾ĞºĞ¾Ğ» | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ |
|--------|------|----------|----------|
| NGINX | 8443 | HTTPS | Frontend + API Gateway |
| HAProxy | 8080 | HTTP | Load Balancer |
| Mule ESB | 8081 | HTTP | REST Proxy Layer |
| Payara DAS | 8180 | HTTP | Domain Admin Server (admin only) |
| Movie-Service #1 | 9003 | HTTP | Spring Boot Instance 1 |
| Movie-Service #2 | 9004 | HTTP | Spring Boot Instance 2 |
| Oscar-Service #1 | 9001 | HTTP | Payara instance1 |
| Oscar-Service #2 | 9002 | HTTP | Payara instance2 |
| Consul HTTP | 8500 | HTTP | Service Registry API |
| Consul DNS | 8600 | DNS | Service Discovery DNS |
| Payara Admin | 4848 | HTTP | Admin Console |

### ĞŸÑ€Ğ¾Ñ‚Ğ¾ĞºĞ¾Ğ»Ñ‹ Ğ¸ Ñ‚ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ğ¸

- **SOAP 1.2** - Ğ´Ğ»Ñ Oscar Service (JAX-WS)
- **REST** - Ğ´Ğ»Ñ Movie Service Ğ¸ Mule ESB Proxy
- **DataWeave 2.0** - Ğ´Ğ»Ñ Ğ¿Ñ€ĞµĞ¾Ğ±Ñ€Ğ°Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ JSON â†” XML
- **JAXB** - Ğ´Ğ»Ñ ÑĞµÑ€Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ Java Ğ¾Ğ±ÑŠĞµĞºÑ‚Ğ¾Ğ² Ğ² XML
- **HAProxy** - Ğ´Ğ»Ñ Ğ±Ğ°Ğ»Ğ°Ğ½ÑĞ¸Ñ€Ğ¾Ğ²ĞºĞ¸ Ğ½Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸
- **Consul** - Ğ´Ğ»Ñ service discovery (Movie Service)
- **Mule ESB 4.6.0 CE** - Ğ´Ğ»Ñ REST proxy layer

---

## âœ… Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ

### ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° HAProxy Ğ±Ğ°Ğ»Ğ°Ğ½ÑĞ¸Ñ€Ğ¾Ğ²ĞºĞ¸

```bash
# Movie Service Ñ‡ĞµÑ€ĞµĞ· HAProxy
for i in {1..4}; do 
  curl -s http://localhost:8080/service1/actuator/health | jq -r .status
done

# Oscar Service Ñ‡ĞµÑ€ĞµĞ· HAProxy
curl -X POST http://localhost:8080/service2/OscarSoapService \
  -H "Content-Type: application/soap+xml" \
  -d '<soap:Envelope>...</soap:Envelope>'
```

### ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Mule ESB REST Proxy

```bash
# Get Directors Without Oscars
curl -X POST http://localhost:8081/service2/oscar/directors/get-loosers \
  -H "Content-Type: application/json" \
  -d '{}'

# Humiliate Directors By Genre
curl -X POST http://localhost:8081/service2/oscar/directors/humiliate-by-genre/ACTION \
  -H "Content-Type: application/json" \
  -d '{}'
```

### ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ñ‡ĞµÑ€ĞµĞ· Nginx

```bash
# Movie Service
curl -k https://localhost:8443/movies

# Oscar Service (Ñ‡ĞµÑ€ĞµĞ· Mule ESB)
curl -k -X POST https://localhost:8443/oscar/directors/get-loosers \
  -H "Content-Type: application/json" \
  -d '{}'
```

---

## ğŸ“¦ Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ½Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹

### Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ½Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹:
- `oscar-service-web/src/main/java/ru/itmo/soa/oscar/web/soap/OscarSoapService.java`
- `muleesb/lab4/src/main/mule/lab4.xml`
- `muleesb/lab4/pom.xml`
- `muleesb/lab4/mule-artifact.json`

### Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ½Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹:
- `oscar-service-web/pom.xml` - ÑƒĞ´Ğ°Ğ»ĞµĞ½Ñ‹ JAX-RS, Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ñ‹ JAXB
- `oscar-service-web/src/main/webapp/WEB-INF/web.xml` - ÑƒĞ¿Ñ€Ğ¾Ñ‰ĞµĞ½
- `oscar-service-ejb/src/main/java/ru/itmo/soa/oscar/dto/*.java` - Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ñ‹ JAXB Ğ°Ğ½Ğ½Ğ¾Ñ‚Ğ°Ñ†Ğ¸Ğ¸
- `oscar-service-ejb/src/main/resources/application.properties` - URL Ñ‡ĞµÑ€ĞµĞ· HAProxy
- `start.sh` - Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½ Mule ESB Ğ¸ HAProxy
- `.gitignore` - Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ñ‹ Mule ESB Ğ°Ñ€Ñ‚ĞµÑ„Ğ°ĞºÑ‚Ñ‹

### Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ½Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹:
- `oscar-service-web/src/main/java/ru/itmo/soa/oscar/web/OscarResource.java`
- `oscar-service-web/src/main/java/ru/itmo/soa/oscar/web/OscarApplication.java`
- `oscar-service-web/src/main/java/ru/itmo/soa/oscar/web/SwaggerUIResource.java`
- `oscar-service-web/src/main/java/ru/itmo/soa/oscar/web/GenericExceptionMapper.java`

---

## ğŸš€ Ğ—Ğ°Ğ¿ÑƒÑĞº Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°

```bash
./start.sh
```

Ğ¡ĞºÑ€Ğ¸Ğ¿Ñ‚ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚:
1. ĞÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºÑƒ Ğ²ÑĞµÑ… ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ²
2. ĞÑ‡Ğ¸ÑÑ‚ĞºÑƒ Ğ¿Ğ¾Ñ€Ñ‚Ğ¾Ğ² (Ğ²ĞºĞ»ÑÑ‡Ğ°Ñ 8080 Ğ´Ğ»Ñ HAProxy)
3. Ğ¡Ğ±Ğ¾Ñ€ĞºÑƒ Ğ²ÑĞµÑ… ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ¾Ğ²
4. Ğ—Ğ°Ğ¿ÑƒÑĞº Payara DAS Ğ¸ Ğ¸Ğ½ÑÑ‚Ğ°Ğ½ÑĞ¾Ğ²
5. Ğ”ĞµĞ¿Ğ»Ğ¾Ğ¹ Oscar Service
6. Ğ—Ğ°Ğ¿ÑƒÑĞº Movie Service Ğ¸Ğ½ÑÑ‚Ğ°Ğ½ÑĞ¾Ğ²
7. Ğ—Ğ°Ğ¿ÑƒÑĞº Mule ESB
8. Ğ—Ğ°Ğ¿ÑƒÑĞº HAProxy

---

## ğŸ“ Ğ’Ğ°Ğ¶Ğ½Ñ‹Ğµ Ğ·Ğ°Ğ¼ĞµÑ‡Ğ°Ğ½Ğ¸Ñ

1. **HAProxy** Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ÑÑ Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¼ (Ğ´Ğ¾ Payara) Ğ½Ğ° Ğ¿Ğ¾Ñ€Ñ‚Ñƒ 8080, Ñ‚Ğ°Ğº ĞºĞ°Ğº Ğ²ÑĞµ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹ Ğ¾Ğ±Ñ€Ğ°Ñ‰Ğ°ÑÑ‚ÑÑ Ğº Ğ½ĞµĞ¼Ñƒ
2. **Payara DAS** Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ Ğ½Ğ° Ğ¿Ğ¾Ñ€Ñ‚Ñƒ 8180 (Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½ Ñ 8080), Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¾ÑĞ²Ğ¾Ğ±Ğ¾Ğ´Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ñ€Ñ‚ 8080 Ğ´Ğ»Ñ HAProxy
3. **Mule ESB** Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ Java 17 (Ğ½Ğµ Java 21)
4. **Consul** Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ Ğ±Ñ‹Ñ‚ÑŒ Ğ·Ğ°Ğ¿ÑƒÑ‰ĞµĞ½ Ğ´Ğ»Ñ service discovery Movie Service
5. Ğ’ÑĞµ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹ Ğ¾Ğ±Ñ€Ğ°Ñ‰Ğ°ÑÑ‚ÑÑ Ğº Ğ´Ñ€ÑƒĞ³Ğ¸Ğ¼ ÑĞµÑ€Ğ²Ğ¸ÑĞ°Ğ¼ Ñ‡ĞµÑ€ĞµĞ· HAProxy (Ğ¿Ğ¾Ñ€Ñ‚ 8080), Ğ° Ğ½Ğµ Ğ½Ğ°Ğ¿Ñ€ÑĞ¼ÑƒÑ Ğº Ğ¸Ğ½ÑÑ‚Ğ°Ğ½ÑĞ°Ğ¼
6. **Nginx** Ğ¿Ñ€Ğ¾ĞºÑĞ¸Ñ€ÑƒĞµÑ‚ `/oscar/*` Ğ½Ğ° Mule ESB (8081), Ğ° `/movies/*` Ğ½Ğ° HAProxy (8080)
7. HAProxy Ğ±Ğ°Ğ»Ğ°Ğ½ÑĞ¸Ñ€ÑƒĞµÑ‚ Ğ½Ğ°Ğ³Ñ€ÑƒĞ·ĞºÑƒ Ğ¼ĞµĞ¶Ğ´Ñƒ Ğ¸Ğ½ÑÑ‚Ğ°Ğ½ÑĞ°Ğ¼Ğ¸ Ñ‡ĞµÑ€ĞµĞ· round-robin Ğ¸ health checks

---

## ğŸ” Ğ˜Ğ·Ğ²ĞµÑÑ‚Ğ½Ñ‹Ğµ Ğ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ñ

1. Endpoint `humiliate-by-genre` Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ñ‚Ñ€ĞµĞ±Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ´Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾Ğ¹ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ´Ğ»Ñ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸ Ğ¿ÑƒÑÑ‚Ñ‹Ñ… Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¾Ğ²
2. ĞŸĞ¾Ğ»Ğ½Ñ‹Ğ¹ ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¾Ğ² Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ñ‚Ñ€ĞµĞ±Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ğ°Ğ³Ğ¸Ğ½Ğ°Ñ†Ğ¸Ğ¸ Ğ¿Ñ€Ğ¸ Ğ±Ğ¾Ğ»ÑŒÑˆĞ¾Ğ¼ Ğ¾Ğ±ÑŠĞµĞ¼Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

---

## ğŸ“š Ğ”Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ°Ñ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ

- **Mule ESB Documentation**: https://docs.mulesoft.com/
- **JAX-WS Specification**: https://javaee.github.io/metro-jax-ws/
- **HAProxy Documentation**: http://www.haproxy.org/#docs
- **Consul Documentation**: https://www.consul.io/docs
