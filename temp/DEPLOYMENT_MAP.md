# üó∫Ô∏è DEPLOYMENT MAP - –ö–∞—Ä—Ç–∞ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã

## üìä –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                              üë§ CLIENT (Browser)                             ‚îÇ
‚îÇ                         https://hostname:8443                                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                     ‚îÇ
                                     ‚îÇ HTTPS (SSL)
                                     ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                          üåê NGINX (Port 8443)                                ‚îÇ
‚îÇ                     /etc/nginx/sites-available/default                       ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  –†–æ–ª–∏:                                                                       ‚îÇ
‚îÇ  ‚Ä¢ –í–µ–±-—Å–µ—Ä–≤–µ—Ä –¥–ª—è Flutter Frontend (SPA)                                    ‚îÇ
‚îÇ  ‚Ä¢ Reverse Proxy –¥–ª—è API                                                    ‚îÇ
‚îÇ  ‚Ä¢ SSL Termination                                                           ‚îÇ
‚îÇ  ‚Ä¢ CORS Headers                                                              ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Routes:                                                                     ‚îÇ
‚îÇ  / ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ> Flutter Web App (static files)                         ‚îÇ
‚îÇ  /movies/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ> proxy_pass http://127.0.0.1:8080/service1/api/v1/...  ‚îÇ
‚îÇ  /oscar/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ> proxy_pass http://127.0.0.1:8080/service2/oscar/...   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                     ‚îÇ
                                     ‚îÇ HTTP
                                     ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                        ‚öñÔ∏è  HAProxy (Port 8080)                               ‚îÇ
‚îÇ                       /etc/haproxy/haproxy.cfg                               ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  –†–æ–ª–∏:                                                                       ‚îÇ
‚îÇ  ‚Ä¢ Load Balancer –¥–ª—è –æ–±–æ–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤                                         ‚îÇ
‚îÇ  ‚Ä¢ Health Checks                                                             ‚îÇ
‚îÇ  ‚Ä¢ Service Discovery integration (Consul)                                   ‚îÇ
‚îÇ  ‚Ä¢ Round-robin –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞                                                 ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Frontend:                                                                   ‚îÇ
‚îÇ  ‚Ä¢ fe_movie (bind *:8080)                                                   ‚îÇ
‚îÇ    - ACL: path_beg /service2 ‚Üí oscar-service                                ‚îÇ
‚îÇ    - Default ‚Üí movie-service                                                 ‚îÇ
‚îÇ                                                                              ‚îÇ
‚îÇ  Backends:                                                                   ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îÇ
‚îÇ  ‚îÇ Backend: movie-service                                           ‚îÇ      ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ Balance: roundrobin                                            ‚îÇ      ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ Health check: GET /service1/actuator/health (expect 200)       ‚îÇ      ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ Service Discovery: Consul DNS                                  ‚îÇ      ‚îÇ
‚îÇ  ‚îÇ   server-template srv 1-10 _movie-service._tcp.service.consul    ‚îÇ      ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îÇ
‚îÇ                                                                              ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îÇ
‚îÇ  ‚îÇ Backend: oscar-service                                           ‚îÇ      ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ Balance: roundrobin                                            ‚îÇ      ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ Health check: enabled (check inter 3000 rise 2 fall 3)         ‚îÇ      ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ Static config:                                                 ‚îÇ      ‚îÇ
‚îÇ  ‚îÇ   - server oscar1 127.0.0.1:9001                                 ‚îÇ      ‚îÇ
‚îÇ  ‚îÇ   - server oscar2 127.0.0.1:9002                                 ‚îÇ      ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                         ‚îÇ                        ‚îÇ
          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
          ‚îÇ                         ‚îÇ   ‚îÇ                   ‚îÇ
          ‚ñº                         ‚ñº   ‚ñº                   ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üé¨ MOVIE-1      ‚îÇ       ‚îÇ üé¨ MOVIE-2      ‚îÇ   ‚îÇ üé≠ OSCAR-1      ‚îÇ   ‚îÇ üé≠ OSCAR-2      ‚îÇ
‚îÇ Port: 9003      ‚îÇ       ‚îÇ Port: 9004      ‚îÇ   ‚îÇ Port: 9001      ‚îÇ   ‚îÇ Port: 9002      ‚îÇ
‚îÇ                 ‚îÇ       ‚îÇ                 ‚îÇ   ‚îÇ                 ‚îÇ   ‚îÇ                 ‚îÇ
‚îÇ Spring Boot     ‚îÇ       ‚îÇ Spring Boot     ‚îÇ   ‚îÇ Payara Server   ‚îÇ   ‚îÇ Payara Server   ‚îÇ
‚îÇ + Consul Client ‚îÇ       ‚îÇ + Consul Client ‚îÇ   ‚îÇ instance1       ‚îÇ   ‚îÇ instance2       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ                         ‚îÇ                      ‚îÇ                     ‚îÇ
         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚îÇ                                                ‚îÇ
                    ‚îÇ Register to Consul                             ‚îÇ Call via JNDI
                    ‚îÇ                                                ‚îÇ
                    ‚ñº                                                ‚ñº
         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚îÇ üì° CONSUL           ‚îÇ                          ‚îÇ üîß EJB POOL         ‚îÇ
         ‚îÇ Port: 8500 (HTTP)   ‚îÇ                          ‚îÇ (Stateless)         ‚îÇ
         ‚îÇ Port: 8600 (DNS)    ‚îÇ                          ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
         ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§                          ‚îÇ OscarServiceBean    ‚îÇ
         ‚îÇ Service Discovery   ‚îÇ                          ‚îÇ @Remote interface   ‚îÇ
         ‚îÇ ‚Ä¢ movie-service     ‚îÇ                          ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
         ‚îÇ   - instance 9003   ‚îÇ                          ‚îÇ Pool Config:        ‚îÇ
         ‚îÇ   - instance 9004   ‚îÇ                          ‚îÇ ‚Ä¢ steady: 5 beans   ‚îÇ
         ‚îÇ Health Checks       ‚îÇ                          ‚îÇ ‚Ä¢ resize: +2        ‚îÇ
         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                          ‚îÇ ‚Ä¢ max: 20 beans     ‚îÇ
                                                           ‚îÇ ‚Ä¢ timeout: 600s     ‚îÇ
                                                           ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üîÑ –ü–æ—Ç–æ–∫ –∑–∞–ø—Ä–æ—Å–æ–≤

### 1Ô∏è‚É£ –ó–∞–ø—Ä–æ—Å –∫ Movie Service

```
Browser
  ‚îÇ
  ‚îÇ GET https://hostname:8443/movies
  ‚îÇ
  ‚ñº
NGINX (8443)
  ‚îÇ SSL Termination
  ‚îÇ CORS Headers
  ‚îÇ proxy_pass http://127.0.0.1:8080/service1/api/v1/movies
  ‚ñº
HAProxy (8080)
  ‚îÇ Health Check: /service1/actuator/health
  ‚îÇ Load Balancing: roundrobin
  ‚îÇ Service Discovery via Consul DNS
  ‚îÇ
  ‚îú‚îÄ‚îÄ> Movie-Service Instance 1 (9003) ‚îÄ‚îÄ‚îê
  ‚îÇ                                       ‚îÇ
  ‚îî‚îÄ‚îÄ> Movie-Service Instance 2 (9004) ‚îÄ‚îÄ‚î§
                                          ‚îÇ
                                          ‚ñº
                                    [Response]
                                          ‚îÇ
                                          ‚îÇ —á–µ—Ä–µ–∑ HAProxy
                                          ‚îÇ —á–µ—Ä–µ–∑ NGINX
                                          ‚ñº
                                      Browser
```

### 2Ô∏è‚É£ –ó–∞–ø—Ä–æ—Å –∫ Oscar Service (—Å –≤—ã–∑–æ–≤–æ–º EJB)

```
Browser
  ‚îÇ
  ‚îÇ POST https://hostname:8443/oscar/directors/get-loosers
  ‚îÇ
  ‚ñº
NGINX (8443)
  ‚îÇ SSL Termination
  ‚îÇ CORS Headers
  ‚îÇ proxy_pass http://127.0.0.1:8080/service2/oscar/directors/get-loosers
  ‚ñº
HAProxy (8080)
  ‚îÇ Health Check: TCP check to 9001/9002
  ‚îÇ Load Balancing: roundrobin
  ‚îÇ
  ‚îú‚îÄ‚îÄ> Oscar-Service Instance 1 (9001) ‚îÄ‚îÄ‚îê
  ‚îÇ    Payara instance1                  ‚îÇ
  ‚îÇ    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îÇ
  ‚îÇ    ‚îÇ OscarResource (WAR)      ‚îÇ      ‚îÇ
  ‚îÇ    ‚îÇ   ‚Üì JNDI Lookup          ‚îÇ      ‚îÇ
  ‚îÇ    ‚îÇ   java:global/...        ‚îÇ      ‚îÇ
  ‚îÇ    ‚îÇ   ‚Üì                      ‚îÇ      ‚îÇ
  ‚îÇ    ‚îÇ OscarServiceBean (EJB)   ‚îÇ      ‚îÇ
  ‚îÇ    ‚îÇ   @Stateless @Remote     ‚îÇ      ‚îÇ
  ‚îÇ    ‚îÇ   ‚Üì                      ‚îÇ      ‚îÇ
  ‚îÇ    ‚îÇ HTTP call to Movie-Svc   ‚îÇ      ‚îÇ
  ‚îÇ    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îÇ
  ‚îÇ             ‚îÇ                        ‚îÇ
  ‚îÇ             ‚îÇ http://127.0.0.1:8080/service1/...
  ‚îÇ             ‚îÇ                        ‚îÇ
  ‚îÇ             ‚îî‚îÄ‚îÄ> HAProxy ‚îÄ‚îÄ> Movie-Service
  ‚îÇ                                      ‚îÇ
  ‚îî‚îÄ‚îÄ> Oscar-Service Instance 2 (9002) ‚îÄ‚îÄ‚î§
       (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ instance1)            ‚îÇ
                                          ‚îÇ
                                          ‚ñº
                                    [Response]
                                          ‚îÇ
                                          ‚îÇ —á–µ—Ä–µ–∑ HAProxy
                                          ‚îÇ —á–µ—Ä–µ–∑ NGINX
                                          ‚ñº
                                      Browser
```

## üì¶ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª–µ–π Oscar Service

```
oscar-service.ear
‚îú‚îÄ‚îÄ META-INF/
‚îÇ   ‚îî‚îÄ‚îÄ application.xml
‚îú‚îÄ‚îÄ ru.itmo.soa-oscar-service-ejb-1.0.0.jar (EJB Module)
‚îÇ   ‚îú‚îÄ‚îÄ ru/itmo/soa/oscar/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ service/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ OscarService.java (@Remote interface)
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ OscarServiceBean.java (@Stateless)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dto/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ META-INF/
‚îÇ       ‚îú‚îÄ‚îÄ ejb-jar.xml
‚îÇ       ‚îî‚îÄ‚îÄ glassfish-ejb-jar.xml (pool config)
‚îÇ
‚îî‚îÄ‚îÄ ru.itmo.soa-oscar-service-web-1.0.0.war (Web Module)
    ‚îú‚îÄ‚îÄ WEB-INF/
    ‚îÇ   ‚îú‚îÄ‚îÄ web.xml
    ‚îÇ   ‚îú‚îÄ‚îÄ glassfish-web.xml (context: /service2)
    ‚îÇ   ‚îî‚îÄ‚îÄ classes/
    ‚îÇ       ‚îî‚îÄ‚îÄ ru/itmo/soa/oscar/web/
    ‚îÇ           ‚îú‚îÄ‚îÄ OscarResource.java (JAX-RS)
    ‚îÇ           ‚îÇ   ‚îî‚îÄ‚îÄ uses JNDI lookup ‚Üí OscarService (REMOTE)
    ‚îÇ           ‚îú‚îÄ‚îÄ EJBLookupHelper.java
    ‚îÇ           ‚îî‚îÄ‚îÄ OscarApplication.java
    ‚îî‚îÄ‚îÄ index.html
```

## üéØ –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### Movie Service (Spring Boot)
- **–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è**: Spring Boot 3.x
- **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤ Consul —á–µ—Ä–µ–∑ Spring Cloud Consul
- **Service Discovery**: –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Consul DNS
- **Health Check**: Spring Actuator `/actuator/health`
- **–ü—Ä–æ—Ñ–∏–ª–∏**: `movie1` (9003), `movie2` (9004)

### Oscar Service (Java EE + EJB)
- **–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è**: Jakarta EE 10, Payara 6
- **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å**: EAR = EJB-JAR + WAR
- **EJB –í—ã–∑–æ–≤**: –£–î–ê–õ–ï–ù–ù–´–ô —á–µ—Ä–µ–∑ JNDI lookup
  - JNDI: `java:global/oscar-service/ru.itmo.soa-oscar-service-ejb-1.0.0/OscarServiceBean!ru.itmo.soa.oscar.service.OscarService`
  - –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è @EJB –∏–Ω–∂–µ–∫—Ü–∏—è (–ª–æ–∫–∞–ª—å–Ω–∞—è)
- **–ü—É–ª EJB**: –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π (5‚Üí20 –±–∏–Ω–æ–≤)
- **–ò–Ω—Å—Ç–∞–Ω—Å—ã**: instance1 (9001), instance2 (9002)

### HAProxy
- **Consul Integration**: Resolver –¥–ª—è movie-service
- **Health Checks**: –ê–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–ª—è –æ–±–æ–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- **–ê–ª–≥–æ—Ä–∏—Ç–º**: Round-robin

### Nginx
- **SSL/TLS**: –¢–µ—Ä–º–∏–Ω–∞—Ü–∏—è SSL
- **Static Hosting**: Flutter Web App
- **Reverse Proxy**: API Gateway

## üîê –ü–æ—Ä—Ç—ã

| –°–µ—Ä–≤–∏—Å           | –ü–æ—Ä—Ç | –ü—Ä–æ—Ç–æ–∫–æ–ª | –û–ø–∏—Å–∞–Ω–∏–µ                    |
|------------------|------|----------|-----------------------------|
| NGINX            | 8443 | HTTPS    | Frontend + API Gateway      |
| HAProxy          | 8080 | HTTP     | Load Balancer               |
| Movie-Service #1 | 9003 | HTTP     | Spring Boot Instance 1      |
| Movie-Service #2 | 9004 | HTTP     | Spring Boot Instance 2      |
| Oscar-Service #1 | 9001 | HTTP     | Payara instance1            |
| Oscar-Service #2 | 9002 | HTTP     | Payara instance2            |
| Consul HTTP      | 8500 | HTTP     | Service Registry API        |
| Consul DNS       | 8600 | DNS      | Service Discovery DNS       |
| Payara DAS       | 4848 | HTTP     | Admin Console               |

## üöÄ –ö–æ–º–∞–Ω–¥—ã –ø—Ä–æ–≤–µ—Ä–∫–∏

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ Consul
curl http://127.0.0.1:8500/v1/catalog/services | jq .

# –ü—Ä–æ–≤–µ—Ä–∫–∞ HAProxy –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏ (Movie)
for i in {1..4}; do curl -s http://127.0.0.1:8080/service1/actuator/health | jq -r .status; done

# –ü—Ä–æ–≤–µ—Ä–∫–∞ HAProxy –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏ (Oscar)
for i in {1..4}; do curl -s -X POST http://127.0.0.1:8080/service2/oscar/directors/get-loosers -H "Content-Type: application/json" | jq 'length'; done

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ NGINX
curl -k https://localhost:8443/movies
curl -k -X POST https://localhost:8443/oscar/directors/get-loosers -H "Content-Type: application/json"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ JNDI lookup –≤ –ª–æ–≥–∞—Ö
grep "SUCCESS! Remote EJB found" /home/hulumulumulus/service-oriented-architecture-itmo/payara/payara6/glassfish/nodes/localhost-domain1/instance*/logs/server.log

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤ Consul
curl http://127.0.0.1:8500/v1/health/service/movie-service | jq -r '.[] | "\(.Service.Address):\(.Service.Port) - \(.Checks[].Status)"'
```

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π #3

### "–í—ã–∑—ã–≤–∞–µ–º—ã–π" —Å–µ—Ä–≤–∏—Å (Movie-Service):
- [x] Spring Boot –æ–∫—Ä—É–∂–µ–Ω–∏–µ
- [x] –í—Ç–æ—Ä–æ–π —ç–∫–∑–µ–º–ø–ª—è—Ä –Ω–∞ –¥—Ä—É–≥–æ–º –ø–æ—Ä—Ç—É (9003, 9004)
- [x] –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ HAProxy –º–µ–∂–¥—É —ç–∫–∑–µ–º–ø–ª—è—Ä–∞–º–∏
- [x] Service Discovery —á–µ—Ä–µ–∑ Consul
- [x] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ

### "–í—ã–∑—ã–≤–∞—é—â–∏–π" —Å–µ—Ä–≤–∏—Å (Oscar-Service):
- [x] –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –º–æ–¥—É–ª–∏: WAR + EJB-JAR
- [x] –í—Å—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –≤ Stateless EJB
- [x] EJB –∏–º–µ–µ—Ç Remote –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (@Remote)
- [x] **–£–¥–∞–ª–µ–Ω–Ω—ã–π –≤—ã–∑–æ–≤ —á–µ—Ä–µ–∑ JNDI lookup** (–ù–ï @EJB)
- [x] –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π –ø—É–ª EJB (5-20 –±–∏–Ω–æ–≤)
- [x] –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –ø—É–ª–∞
- [x] –í—Ç–æ—Ä–æ–π —ç–∫–∑–µ–º–ø–ª—è—Ä Payara (9001, 9002)
- [x] –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ HAProxy

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:
- [x] API —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å –ø—Ä–µ–¥—ã–¥—É—â–∏–º–∏ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—ã–º–∏
- [x] Health checks –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- [x] CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [x] SSL/TLS —á–µ—Ä–µ–∑ NGINX
- [x] Flutter Web –∫–ª–∏–µ–Ω—Ç

